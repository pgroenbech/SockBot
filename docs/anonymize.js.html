<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: sock_modules/anonymize.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: sock_modules/anonymize.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*jslint node: true, indent: 4 */
/**
 * Anonymize module. Responsible for allowing anonymous users to "puppet" the bot, making it speak instead of them.
 * @module anonymize
 */
'use strict';
var xRegExp = require('xregexp').XRegExp;
var discourse,
    conf,
    rQuote = xRegExp('\\[quote.*post:(?&lt;post_number>\\d+).*' +
        'topic:(?&lt;topic_id>\\d+)');

/** Description of the module */
exports.description = 'Anonymize replies';

/** 
 * Configuration properties.
 * @property enabled - Whether to use anonymizer or not. Defaults to false.
 */
exports.configuration = {
    enabled: false
};

/** Name of the module */
exports.name = 'Anonymize';

/** Priority of the module */
exports.priority = 0;

/** Module version */
exports.version = '1.13.0';

/**
 * Bootstrap the module.
 * @param {string} browser - 
 */
exports.begin = function begin(browser, config) {
    discourse = browser;
    conf = config.modules[exports.name];
};

/**
 * Runs on notification. If the anonymizer is not enabled or there's no quote, 
 * it early aborts. Otherwise, it sends a post to the quote's topic containing 
 * the text.
 * @param {string} type - The type of event. Only responds if this is 'private_message'
 * @param {string} notification - The notification to respond to
 * @param {string} topic - Unused.
 * @param {string} post - The post the notification was for
 * @param {function} callback - The callback to notify when processing is complete.
 */
exports.onNotify = function (type, notification, topic, post, callback) {
    if ((!conf.enabled || !post) ||
        (!post.cleaned || type !== 'private_message')) {
        return callback();
    }
    var match = rQuote.xexec(post.raw);
    if (!match || post.topic_id.toString() === match.topic_id) {
        return callback();
    }

    var anon = 'Anonymizied Reply Sent. Thank you for using Anonymizer, ' +
        'a SockIndustries application.';
    discourse.log('Posting anonymously to ' + match.topic_id);
    discourse.createPost(match.topic_id, match.post_number, post.raw,
        function () {
            setTimeout(function () {
                discourse.createPost(notification.topic_id,
                    notification.post_number, anon, function () {

                    });
            }, 500);
            callback(true);
        });
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-anonymize.html">anonymize</a></li><li><a href="module-dice.html">dice</a></li></ul><h3>Global</h3><ul><li><a href="global.html#configuration Default Configuration settings for this
sock_module">configuration Default Configuration settings for this
sock_module</a></li><li><a href="global.html#description Brief description of this module for Help Docs">description Brief description of this module for Help Docs</a></li><li><a href="global.html#handleMessage">handleMessage</a></li><li><a href="global.html#name The name of this sock_module">name The name of this sock_module</a></li><li><a href="global.html#priority If defined by a sock_module it is the priority
of the module with respect to other modules.

sock_modules **should not** define modules with negative permissions.
Default value is 50 with lower numbers being higher priority.">priority If defined by a sock_module it is the priority
of the module with respect to other modules.

sock_modules **should not** define modules with negative permissions.
Default value is 50 with lower numbers being higher priority.</a></li><li><a href="global.html#uuid">uuid</a></li><li><a href="global.html#version The version of this sock_module">version The version of this sock_module</a></li><li>{number}</li><li>{object}</li><li>{string}</li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Tue Apr 21 2015 17:39:55 GMT-0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
